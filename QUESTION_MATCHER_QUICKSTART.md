# üöÄ QuestionMatcher - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## TL;DR - –ì–ª–∞–≤–Ω–æ–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∏—Å–∫ 50 –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞–Ω–∏–º–∞–µ—Ç 29 –º–∏–Ω—É—Ç (35 —Å–µ–∫ √ó 50)
**–†–µ—à–µ–Ω–∏–µ:** QuestionMatcher —Å fuzzy matching –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ –∂–µ 50 –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞ 2.5 –º–∏–Ω—É—Ç—ã (3 —Å–µ–∫ √ó 50)
**–£—Å–∫–æ—Ä–µ–Ω–∏–µ:** **12x –±—ã—Å—Ç—Ä–µ–µ!** üöÄ

---

## üì¶ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –§–∞–π–ª—ã

```
src/utils/question_matcher.py          ‚Üê –û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
OPTIMIZATION_PROPOSAL.md               ‚Üê –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
test_question_matcher_demo.py          ‚Üê –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç—ã
QUESTION_MATCHER_QUICKSTART.md         ‚Üê –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

### 2. –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```python
class QuestionMatcher:
    # –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
    .refresh_heading_pool()            # –ü–æ–ª—É—á–∏—Ç—å –í–°–ï heading'—ã –∑–∞ 1 –∑–∞–ø—Ä–æ—Å
    .find_question()                   # Fuzzy search –≤–æ–ø—Ä–æ—Å–∞
    .answer_question_optimized()       # –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å (–ë–´–°–¢–†–û)
    .check_questions_batch()           # –ü–∞–∫–µ—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    .get_stats()                       # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
```

---

## üéØ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (3 —à–∞–≥–∞)

### –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```python
from utils.question_matcher import QuestionMatcher

# –°–æ–∑–¥–∞—Ç—å matcher
matcher = QuestionMatcher(page, fuzzy_threshold=0.75)

# –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
matcher.preload_page()
```

### –®–∞–≥ 2: –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

```python
# –í–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ (–ú–ï–î–õ–ï–ù–ù–û):
# answer_question(page, "What is your name?", "John")  # 35 —Å–µ–∫

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π (–ë–´–°–¢–†–û):
matcher.answer_question_optimized("What is your name?", "John")  # 3 —Å–µ–∫
matcher.answer_question_optimized("What's your age?", "25")
matcher.answer_question_optimized("What is your favorite color?", "Blue")
# ... –µ—â–µ 47 –≤–æ–ø—Ä–æ—Å–æ–≤
```

### –®–∞–≥ 3: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```python
# –í –∫–æ–Ω—Ü–µ –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
matcher.print_stats()
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ fuzzy_threshold

```python
# –°—Ç—Ä–æ–≥–æ–µ (–¥–ª—è —Ç–æ—á–Ω—ã—Ö —Ñ–æ—Ä–º)
matcher = QuestionMatcher(page, fuzzy_threshold=0.85)

# –°—Ä–µ–¥–Ω–µ–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
matcher = QuestionMatcher(page, fuzzy_threshold=0.75)

# –ú—è–≥–∫–æ–µ (–¥–ª—è —Ñ–æ—Ä–º —Å –≤–∞—Ä–∏–∞—Ü–∏—è–º–∏ —Ç–µ–∫—Å—Ç–∞)
matcher = QuestionMatcher(page, fuzzy_threshold=0.65)
```

**–í—ã–±–æ—Ä –ø–æ—Ä–æ–≥–∞:**
- `0.85-0.90` ‚Üí –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π
- `0.75-0.80` ‚Üí –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ (–∞–ø–æ—Å—Ç—Ä–æ—Ñ—ã, –∑–Ω–∞–∫–∏)
- `0.60-0.70` ‚Üí –µ—Å–ª–∏ –º–Ω–æ–≥–æ –≤–∞—Ä–∏–∞—Ü–∏–π (–æ–ø–µ—á–∞—Ç–∫–∏, —Å–ª–µ–Ω–≥)

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ | –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|---------------|--------------|-----------|
| –í—Ä–µ–º—è –Ω–∞ 1 –≤–æ–ø—Ä–æ—Å | 35 —Å–µ–∫ | 3 —Å–µ–∫ | **12x** |
| –í—Ä–µ–º—è –Ω–∞ 50 –≤–æ–ø—Ä–æ—Å–æ–≤ | 29 –º–∏–Ω | 2.5 –º–∏–Ω | **12x** |
| Fuzzy matching | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚àû |
| –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚àû |
| –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚àû |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ó–∞–ø—É—Å–∫ –¥–µ–º–æ

```bash
python test_question_matcher_demo.py
```

–ü–æ–∫–∞–∂–µ—Ç:
- Fuzzy matching –ø—Ä–∏–º–µ—Ä—ã
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç 2: Fuzzy matching

```python
# –û—Ä–∏–≥–∏–Ω–∞–ª
"What is your favorite color?"

# –≠—Ç–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–∂–µ –Ω–∞–π–¥—É—Ç—Å—è:
"What's your favorite color?"     # ‚úÖ 96% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
"What is your favourite color?"   # ‚úÖ 98% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
"Whats your favorite color"       # ‚úÖ 96% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
```

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –†—É—á–Ω–∞—è –∑–∞–º–µ–Ω–∞ –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ

**–î–æ:**
```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–µ–π—á–∞—Å)
answer_question(page, "What is your name?", "John")
```

**–ü–æ—Å–ª–µ:**
```python
# –ù–æ–≤—ã–π –∫–æ–¥ (–¥–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é)
from utils.question_matcher import QuestionMatcher
matcher = QuestionMatcher(page, fuzzy_threshold=0.75)
matcher.answer_question_optimized("What is your name?", "John")
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä (TODO)

–í `src/utils/playwright_parser.py`:

```python
def _generate_converted_code(self, actions, url):
    code_lines = []

    # ‚úÖ –î–û–ë–ê–í–ò–¢–¨: –ò–º–ø–æ—Ä—Ç –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è matcher'–∞
    from .question_matcher import generate_matcher_code
    code_lines.append(generate_matcher_code())

    # ... –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π ...

    # ‚ùå –ó–ê–ú–ï–ù–ò–¢–¨: answer_question ‚Üí matcher.answer_question_optimized
    # (–ª–æ–≥–∏–∫–∞ –∑–∞–º–µ–Ω—ã –≤ –ø–∞—Ä—Å–µ—Ä–µ)

    return '\n'.join(code_lines)
```

---

## üí° –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. Batch-–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤

```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞ 1 –ø—Ä–æ—Ö–æ–¥
questions = [
    "What is your name?",
    "What is your age?",
    "What is your email?"
]

results = matcher.check_questions_batch(questions)
# {'What is your name?': True, 'What is your age?': True, ...}
```

### 2. Retry –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ø—É–ª–∞
success = matcher.answer_question_with_retry(
    "What is your name?",
    "John",
    max_retries=3
)
```

### 3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```python
stats = matcher.get_stats()
print(f"–ù–∞–π–¥–µ–Ω–æ: {stats['questions_found']}")
print(f"–ö–µ—à-—Ö–∏—Ç–æ–≤: {stats['cache_hits']}")
print(f"Hit rate: {stats['cache_hit_rate']}")
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "–í–æ–ø—Ä–æ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–π `fuzzy_threshold`

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü–æ–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥
matcher = QuestionMatcher(page, fuzzy_threshold=0.65)
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "–ù–∞–π–¥–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª–∏—à–∫–æ–º –º—è–≥–∫–∏–π `fuzzy_threshold`

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü–æ–≤—ã—Å–∏—Ç—å –ø–æ—Ä–æ–≥
matcher = QuestionMatcher(page, fuzzy_threshold=0.85)
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "–ö–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ —Ä—è–¥–æ–º —Å heading"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å exact=False –¥–ª—è –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
matcher.answer_question_optimized("Question?", "Answer", exact=False)

# –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ª–∞–¥–∫—É:
heading = matcher.find_question("Question?")
print(heading.locator('xpath=../..').inner_html()[:500])
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **OPTIMIZATION_PROPOSAL.md** - –ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è
- **src/utils/question_matcher.py** - –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- **test_question_matcher_demo.py** - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

**–≠—Ç–∞–ø 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å–µ–π—á–∞—Å)**
- [x] –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `QuestionMatcher`
- [x] –ù–∞–ø–∏—Å–∞—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é
- [x] –ù–∞–ø–∏—Å–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –∞–Ω–∫–µ—Ç–µ —Å 30+ –≤–æ–ø—Ä–æ—Å–∞–º–∏

**–≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `playwright_parser.py`
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `answer_question()` –Ω–∞ `matcher.answer_question_optimized()`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã `test_question_answer.py`

**–≠—Ç–∞–ø 3: GUI**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É `fuzzy_threshold` –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "Refresh headings"
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–≠—Ç–∞–ø 4: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ**
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–æ–∫
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ–ª–µ–∫—Ç–æ–≤ (dropdown)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–µ–∫–±–æ–∫—Å–æ–≤

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–û (—Å—Ç–∞—Ä—ã–π –∫–æ–¥):**
```
‚è±Ô∏è  50 –≤–æ–ø—Ä–æ—Å–æ–≤ = 29 –º–∏–Ω—É—Ç
‚ùå –ü–æ—Ä—è–¥–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
‚ùå –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (exact=True)
‚ùå –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
```

**–ü–û–°–õ–ï (–Ω–æ–≤—ã–π –∫–æ–¥):**
```
‚è±Ô∏è  50 –≤–æ–ø—Ä–æ—Å–æ–≤ = 2.5 –º–∏–Ω—É—Ç—ã (12x –±—ã—Å—Ç—Ä–µ–µ!)
‚úÖ –õ—é–±–æ–π –ø–æ—Ä—è–¥–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤
‚úÖ Fuzzy matching (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤–∞—Ä–∏–∞—Ü–∏—è–º–∏)
‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–∏—Å–∫–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ)
‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 30 —Å–µ–∫—É–Ω–¥

```python
# 1. –ò–º–ø–æ—Ä—Ç
from utils.question_matcher import QuestionMatcher

# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
matcher = QuestionMatcher(page, fuzzy_threshold=0.75)

# 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
matcher.answer_question_optimized("What is your name?", "John")
matcher.answer_question_optimized("What is your age?", "25")
# ... –µ—â–µ 48 –≤–æ–ø—Ä–æ—Å–æ–≤

# 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
matcher.print_stats()
```

**–ì–æ—Ç–æ–≤–æ! üéØ**

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–í–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ **OPTIMIZATION_PROPOSAL.md** –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ **test_question_matcher_demo.py** –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤
- –ò–∑—É—á–∏—Ç–µ **src/utils/question_matcher.py** –¥–ª—è –∫–æ–¥–∞

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-11-21
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
